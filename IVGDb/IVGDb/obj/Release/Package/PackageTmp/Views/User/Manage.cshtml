@using IVGDb.Models;

@model UserViewModel

@{
    ViewBag.Title = "Manage";
}

@if(User.Identity.Name.Length > 0)
{ 
    <div class="row" id="User-profile">
        <div class="col-sm-3">
            <a class="btn" data-toggle="modal" href="#ImageModal"><img src="@Html.DisplayFor(m => m.UserProfilePicLink)" id="User-img" width="200" height="200" /></a>
        </div>
        <div class="col-sm-2">
            <h3>@Html.DisplayFor(m => m.Username)</h3>
        </div>
        @if(Model.Role == 1)
        { 
        <div class="row col-sm-7">
            <div class="col-sm-12" id="Role-log">
                <h3>Manage Users</h3>
                @foreach (var user in Model.AdminList)
                {
                    <div class="custom-manage-div">
                        <input type="text" disabled="disabled" value="@user.User.Username" />
                        <input type="hidden" name="username" value="@user.User.Username" />
                    </div>
                    <div class="custom-manage-div">
                        <select name="role">
                            @foreach (var role in ViewBag.RolesList)
                            {
                                if (role.RoleName == user.Role.RoleName)
                                {
                                    <option value="@role.ID" selected="selected">@role.RoleName</option>
                                }
                                else
                                {
                                    <option value="@role.ID">@role.RoleName</option>
                                }
                            }
                        </select>
                    </div>
                    <div class="custom-manage-div">
                        <button type="submit" class="btn btn-default">Update</button>
                    </div>
                }
            </div>
        </div>
        }
    </div>
    
    <!-- Modal Window -->
    <div class="modal fade" id="ImageModal" tabindex="-1" role="dialog" aria-labelledby="ImageModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    @using(Html.BeginForm("SetUserPic", "User", FormMethod.Post))
                    {
                        <label for="UesrProfilePicLink">Image URL:</label>
                        @Html.TextBoxFor(m => m.UserProfilePicLink)
                        @Html.HiddenFor(m => m.Username)
                        <input type="submit" value="Set" />
                    }
                </div>
            </div>
        </div>
    </div>
}
else
{
    <h3>You must be logged in to view this page. Please login above from the menu</h3>
}